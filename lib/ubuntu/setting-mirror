#!/bin/bash

# Setting ubuntu mirror address. if the configuration file already exists, back it up.
set -euo pipefail

SOURCES_LIST="/etc/apt/sources.list"

setting_mirror() {
  # Copy remote custom Ubuntu software source mirror configuration and settings
  curl "https://raw.githubusercontent.com/snow-zen/my-custom-config/master/ubuntu/sources.list" --create-dirs -o "${SOURCES_LIST}"
}

backup_origin_config() {
  # Only when the configuration file exists, backup the original configuration file
  if [ -e "${SOURCES_LIST}" ]; then
    cp "${SOURCES_LIST}" "${SOURCES_LIST}.origin"
  fi
}

if [ ! -f /etc/os-release ]; then
  echo "The /etc/os-release file is not found." >&2
  exit 1
fi

CURRENT_SYSTEM=$(awk -F= '/^ID=/{print $2}' /etc/os-release)
if [ "${CURRENT_SYSTEM}" != "ubuntu" ]; then
  echo "The script does not support the current system. please execute the script on the Ubuntu system." >&2
  echo "Current system message: ${CURRENT_SYSTEM}" >&2
  exit 1
fi

backup_origin_config
setting_mirror
